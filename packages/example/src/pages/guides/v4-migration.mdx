---
title: V4.0 Migration
description: Guide for migrating to v3.0 of the theme
---

<PageDescription>

Carbon's Gatsby Theme uses version 5 of the Gatsby library. This update combines
the control and scalability of server-side rendering with the performance of
static-site generation. The major version change comes with the potential for
breaking changes, this guide aims to cover the most likely issues a site built
with the Carbon Gatsby theme might encounter. To have the smoothest possible
experience, we recommend [upgrading to v4](/guides/v3-migration) of Carbon's
Gatsby Theme first if you haven't already done so.

</PageDescription>

## Breaking changes

1. Bumped minimum version of Gatsby to `v5`
1. Gatsby files (i.e. gatsby-config.js and gatsby-node.js), need to be converted
   to **.mjs** (node modules) files.
1. TBD...

## Gatsby migration guide

In this section we'll cover the most likely issues site's built with the Carbon
Gatsby theme might encounter when migrating. If you encounter any issues, or
your site leverages more advanced Gatsby configuration, check to see if it's
covered in the
[official Gatsby v5 migration guide](https://www.gatsbyjs.com/docs/reference/release-notes/migrating-from-v4-to-v5/).
To facilitate an easy upgrade path, we recommend
[upgrading to v3](/guides/v3-migration) of Carbon's Gatsby Theme first if you
haven't already done so.

<InlineNotification>

Note: We'll use yarn for the shell commands here. Replace them with the `npm`
equivalent if your project uses `npm` as its package manager.

</InlineNotification>

1. Update Gatsby to v5
   ```
   yarn add gatsby@latest
   ```
2. Update Gatsby plugins (including the theme)

   ```
   yarn upgrade-interactive
   ```

3. Run `yarn dev:clean` to delete and rebuild your project's development bundle

## Troubleshooting

---

<InlineNotification kind="warning">

The following is still being updated.

</InlineNotification>

If you are shadowing the homepage you need to update the file path
`packages/example/src/components/Homepage.js`

```jsx
// Before
import HomepageTemplate from 'gatsby-theme-carbon/src/templates/Homepage';
// After
import HomepageTemplate from 'gatsby-theme-carbon/src/components/Layouts/Homepage';
```

Similarly if you are importing any layouts you need to update the file path

```jsx
// Before
import Layout from 'gatsby-theme-carbon/src/templates/Default';
// After
import Layout from 'gatsby-theme-carbon/src/components/Layouts/Default';
```

Update file path inside the shadowed Layout
`packages/example/src/gatsby-theme-carbon/components/Layout.js`

```jsx
// Before
import Switcher from 'gatsby-theme-carbon/src/components/Switcher';
// After
import { Switcher } from 'gatsby-theme-carbon/src/components/Switcher';
```

Move the shadowed homepage file to

Markdown link with title needs double quotes

```jsx
// Before
[I'm a markdown link with title](https://www.carbondesignsystem.com "Carbon's Homepage")
// After
[I'm a markdown link with title](https://www.carbondesignsystem.com 'Carbon's Homepage')
```

Comments

```jsx
// Before
<!-- Place comments here -->
// After
{/* Place comments here */}
```

Prettier ignore

```jsx
// Before
<!-- prettier-ignore-start -->
### MDX you want prettier to ignore
<!-- prettier-ignore-end -->
// After
{/* prettier-ignore-start */}

### MDX you want prettier to ignore

{/* prettier-ignore-end */}
```

Fix mdx/markdown errors

```jsx
(specifically, files with permissions <`400`)
(specifically, files with permissions &lt;`400`)


<carbon@us.ibm.com>
[carbon@us.ibm.com](mailto:carbon@us.ibm.com)
```
