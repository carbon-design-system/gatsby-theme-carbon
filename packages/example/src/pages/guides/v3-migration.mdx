---
title: V3.0 Migration
description: Guide for migrating to v2.0 of the theme
---

<PageDescription>

Carbon's Gatsby Theme uses version 4 of the Gatsby library. This update combines
the control and scalability of server-side rendering with the performance of
static-site generation. The major version change comes with the potential for
breaking changes, this guide aims to cover the most likely issues a site built
with the Carbon Gatsby theme might encounter.

</PageDescription>

## Breaking Changes

1. Bumped minimum version of Gatsby to `v4`
2. Removed the `emotion` theme provider and its dependenices.
   - This impacts sites styling their project using `emotion` and depending on
     theme values supplied by the theme
   - If this applies to your project, you can recreate the theme's emotion
     integration installing `emotion` and replicating the
     [`ThemeProvider`](https://github.com/carbon-design-system/gatsby-theme-carbon/blob/857abf691590d86b9384a8f35256e8f54fad299e/packages/gatsby-theme-carbon/src/components/ThemeProvider.js)
     component and
     [`theme.js`](https://github.com/carbon-design-system/gatsby-theme-carbon/blob/main/packages/gatsby-theme-carbon/src/util/theme.js).
     Finally, you'll want to shadow
     [`wrap-root-element.js`](https://github.com/carbon-design-system/gatsby-theme-carbon/blob/857abf691590d86b9384a8f35256e8f54fad299e/packages/gatsby-theme-carbon/src/util/wrap-root-element.js#L1)
     to add back the `ThemeProvider` wrapper.

## Gatsby Migration guide

In this section we'll cover the most likely issues site's built with the Carbon
gatsby theme might encounter when migrating. If you encounter any issues, or
your site leverages more advanced gatsby configuration, check to see if it's
covered in the
[official Gatsby v4 migration guide](https://www.gatsbyjs.com/docs/reference/release-notes/migrating-from-v3-to-v4/).

<InlineNotification>

Note: We'll use yarn for the shell commands here. Replace them with the `npm`
equivalent if your project uses `npm` as its package manager.

</InlineNotification>

1. Update Gatsby to v4
   ```
   yarn add gatsby@latest-v4
   ```
2. Update gatsby plugins (including the theme)
   ```
   yarn upgrade-interactive --latest
   ```
3. Check to see if you're using `sizes` or `resolutions` with `gatsby-image`. Do
   a project wide search for `gatsby-image`. Check to make sure that you're not
   using these
   [deprecated props](https://www.gatsbyjs.com/docs/reference/release-notes/migrating-from-v2-to-v3/#removal-of-sizes--resolutions-for-image-queries)
4. Check your Sass (and potentially JSON) to ensure they're imported as ES
   Modules. "Default exports" are no longer supported.

   ```js path=Before
   import styles from './MySpan.module.scss';
   import metadata from './metadata.json';

   const MySpan = () => <span className={styles.mySpan} />;
   ```

   ```js path=After
   import { mySpan } from './MySpan.module.scss';
   // Or import * as styles from './MySpan.module.scss'

   import * as metadata from './metadata.json';

   const MySpan = () => <span className={mySpan} />;
   ```

5. Make sure to update the path of your shadowed components (Footer and Header).
   - Create a folder each for `Footer` and `Header`.
   - Change the file name to `index.js` inside each corresponding folder. More
     info can be found in the
     [shadowing docs](https://gatsby-theme-carbon.vercel.app/guides/shadowing/#shadowing-basics)
6. If you have a custom webpack config, be sure your config is compatible with
   [Webpack 5](https://webpack.js.org/migrate/5/) (the version Gatsby 3+ uses)
8. Run `yarn dev:clean` to delete and rebuild your projects development bundle

## Troubleshooting

- Try deleting your node_modules, running `yarn cache clean` and `yarn install`
  (or `npm cache clean --force` and npm install)
- Feel free to reach out in the #gatsby-theme-carbon slack channel or open an
  issue on GitHub

## Carbon v11 migration guide

As part of this release, the theme has been updated to use Carbon v11. In this
section we'll cover the areas that will need to be updated in relation to this
dependency upgrade.

1. Update your color, motion, and type tokens where appropriate. Use
   [the migration guide from Github](https://github.com/carbon-design-system/carbon/blob/main/docs/migration/v11.md)
   for a fantastic token reference guide.

<InlineNotification>

Pro tip: Do a search for the v10 token in question in your local dev environment
throughout the entire project. Once found, copy it to your clipboard, then
switch over to the migration guide on Github. Hit `CMD+F` to search the page to
find/replace with the corresponding v11 token.

</InlineNotification>

2. Update icon usage

As part of v11, the usage pattern for icons has changed. Icons are no longer
imported by size, instead size is configured via the `size` prop. Full details
can be found in the
[Carbon v11 migration guide](https://github.com/carbon-design-system/carbon/blob/main/docs/migration/v11.md#changes-to-size).

<!-- prettier-ignore-start -->
```md path=Before
import { Add32, Add24, Add20, Add16 } from '@carbon/icons-react';

function MyComponent() {
  return (
    <>
      <Add32 />
      <Add24 />
      <Add20 />
      <Add16 />
    </>
  );
}
```

```md path=After
import { Add } from '@carbon/icons-react';

function MyComponent() {
  return (
    <>
      <Add size={32} />
      <Add size={24} />
      <Add size={20} />
      <Add />
    </>
  );
}
```
<!-- prettier-ignore-end -->

A very easy way to make this change is to use the automated migration tool
available from the
[Carbon Upgrade CLI](https://github.com/carbon-design-system/carbon/blob/main/packages/upgrade/README.md#usage).
You can run a test of this automated migration against your codebase with the
following command. When ready to write the changes, additionally pass the `-w`
flag

```
npx @carbon/upgrade migrate icons-react-size-prop
```

<InlineNotification>

This automated migration will not rewrite imports in `.mdx` files. Search all
your `.mdx` files for `@carbon/icons-react` and manually update their import.
Additionally update their usage to include the appropriate `size` prop.

</InlineNotification>

3. Remove any prefix imports. Replace the following in your classnames:

```md path=Before
<div className={`${prefix}--fancy-class`}>
```

```md path=After
<div className='cds--fancy-class'>
```

The tips above should get you most, if not all of the way there, but your
mileage may vary based on how much you have customized your site. If you have
still have issues check out the v11 migration guides below.

<Row className="resource-card-group">
  <Column colMd={4} colLg={4} noGutterSm>
    <ResourceCard
      subTitle="v11 Migration Guide on Github"
      href="https://github.com/carbon-design-system/carbon/blob/main/docs/migration/v11.md"
      actionIcon="launch"
      >

![Github icon](/images/github-icon.png)

  </ResourceCard>
</Column>
<Column colMd={4} colLg={4} noGutterSm>
    <ResourceCard
      subTitle="v11 Migration Guide"
     href="https://carbondesignsystem.com/migrating/guide/develop"
      actionIcon="launch"
      >

  </ResourceCard>
</Column>
</Row>
